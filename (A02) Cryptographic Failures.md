# Cryptographic Failures

Cryptographic Fallures หมายถึงการใช้การเข้ารหัสที่ไม่ถูกต้องหรือไม่ปลอดภัย ซึ่งทำให้ข้อมูลสำคัญสามารถถูกเข้าถึงหรือแก้ไขได้โดยไม่ได้รับอนุญาต

## Crypto Basics

Crypto Basics หมายถึงการใช้การเข้ารหัสที่ไม่เหมาะสมหรือไม่ปลอดภัย ทำให้ข้อมูลที่สำคัญสามารถถูกเข้าถึงหรือแก้ไขได้โดยไม่ได้รับอนุญาต

  ### Encoding แสดงการแปลงข้อมูลให้อยู่ในรูปแบบที่สามารถส่งผ่านเครือข่ายได้
  
  - **ตัวอย่าง**
      
    สมมติว่าเรามีข้อความว่า `Hello, World!` และต้องการเข้ารหัสเป็น Base64

    1.เริ่มต้นด้วยการแปลงข้อความเป็นไบต์

    H: 01001000 e: 01100101 l: 01101100 l: 01101100 o: 01101111 ,: 00101100 (space): 00100000
    W: 01010111 o: 01101111 r: 01110010 l: 01101100 d: 01100100 !: 00100001

    2.แบ่งข้อมูลเป็นกลุ่มละ 6 บิต (เพราะ Base64 ใช้ 6 บิตต่ออักขระ)
    
    010010 000110 010101 101100 011011 000110 111100 101100 001000 000101 011101 101111 011100 100111 011011 000100 011001 000010 000001

    3.แปลงแต่ละกลุ่ม 6 บิตไปเป็น Base64
    
    010010: S 000110: G 010101: V 101100: s 011011: b 000110: G 111100: 8 101100: s 001000: I 000101: F 011101: d 101111: v 011100: c 100111: J 011011: b 000100: E 011001: Z 000010: C 000001: B

    4.รวมเป็นข้อความ Base64

    SGVsbG8sIFdvcmxkIQ==
      
  - **วิธีการป้องกัน**

    ถึงแม้ว่า Encoding จะไม่ได้เกี่ยวข้องกับความปลอดภัยโดยตรง แต่มีข้อควรระวังดังนี้:

    - ตรวจสอบการใช้ Encoding ที่ถูกต้อง ใช้การเข้ารหัสที่เหมาะสมสำหรับงาน เช่น Base64 สำหรับการแปลงข้อมูลไบต์ให้เป็นตัวอักษร
   
    - ตรวจสอบข้อมูลที่เข้ามา ตรวจสอบและทำความสะอาดข้อมูลที่ได้รับจากผู้ใช้ เพื่อป้องกันการใช้ Encoding เพื่อหลีกเลี่ยงการตรวจสอบความปลอดภัย เช่น การใช้ Encoding เพื่อซ่อน SQL Injection หรือ XSS

    - เข้าใจว่า Encoding ไม่ใช่การเข้ารหัสข้อมูล อย่าสับสนระหว่าง Encoding และ Encryption เพราะ Encoding ไม่ได้ป้องกันข้อมูลจากการถูกโจมตี

___

  ### Hashing การสร้าง hash value เพื่อรักษาความสมบูรณ์ของข้อมูล
    
  - **ตัวอย่าง**

    สมมติว่าเรามีข้อความ `hello world` และเราต้องการแปลงข้อความนี้เป็น hash value โดยใช้ฟังก์ชัน hash อย่าง SHA-256

    ```
    Input: "hello world"
    SHA-256 Hash Value: b94d27b9934d3e08a52e52d7da7dabfa4a93e0e00f6b27b1a1a34a7c7f62e1e8
    ```

    ไม่ว่าจะใช้ฟังก์ชัน hash กับข้อความนี้กี่ครั้ง ค่าที่ได้จะเป็นค่าเดิมเสมอ แต่ไม่สามารถย้อนกลับจาก hash value ไปเป็นข้อความเดิมได้

  - **วิธีการป้องกัน**
      
    การใช้งาน hashing ให้ปลอดภัย สามารถทำได้ด้วยวิธีดังนี้:

    - ใช้ฟังก์ชัน hash ที่ปลอดภัย เลือกใช้ฟังก์ชัน hash ที่ได้รับการยอมรับว่าเป็นมาตรฐานและปลอดภัย เช่น SHA-256 หรือ SHA-3 หลีกเลี่ยงการใช้ฟังก์ชันที่ล้าสมัยและไม่ปลอดภัย เช่น MD5 หรือ SHA-1

    - ใช้ Salt การเพิ่ม salt (ค่าแบบสุ่ม) เข้าไปในข้อมูลก่อนทำการ hashing เพื่อป้องกันการโจมตีแบบ rainbow table ทำให้การ hash รหัสผ่านเดียวกันแต่คนละ salt ได้ค่า hash ที่แตกต่างกัน

    - ใช้ Pepper นอกเหนือจากการใช้ salt สามารถใช้ pepper (ค่าแบบสุ่มที่ไม่ถูกเก็บในฐานข้อมูล) เพื่อเพิ่มความปลอดภัยอีกชั้นหนึ่ง

    - การใช้งานฟังก์ชัน hash หลายรอบ เช่นการใช้ PBKDF2, bcrypt หรือ Argon2 ซึ่งเป็นฟังก์ชันที่ออกแบบมาเพื่อเพิ่มความยากในการถอดรหัสโดยใช้ฟังก์ชัน hash หลายรอบ

  - **Video ตัวอย่าง** [Hijack Session](https://youtu.be/YO8rsCMVUyY)

___

  ### Encryption การเข้ารหัสข้อมูลเพื่อปกป้องความลับ

  - **ตัวอย่าง**
      
    สมมุติว่าคุณต้องการส่งข้อความ "HELLO" ให้เพื่อนของคุณ และไม่ต้องการให้ใครคนอื่นรู้ว่าคุณส่งอะไร คุณสามารถใช้การเข้ารหัสแบบง่าย ๆ เช่น Caesar Cipher โดยการเลื่อนตัวอักษรทุกตัวไปข้างหน้า 3 ตำแหน่ง
      
    - H เลื่อน 3 ตำแหน่งกลายเป็น K
    - E เลื่อน 3 ตำแหน่งกลายเป็น H
    - L เลื่อน 3 ตำแหน่งกลายเป็น O
    - L เลื่อน 3 ตำแหน่งกลายเป็น O
    - O เลื่อน 3 ตำแหน่งกลายเป็น R
        
    ดังนั้นข้อความที่เข้ารหัสคือ "KHOOR" ซึ่งถ้าใครไม่มีวิธีการถอดรหัสก็จะไม่สามารถรู้ได้ว่าข้อความเดิมคืออะไร

  - **วิธีการป้องกัน**
      
    - ใช้คีย์เข้ารหัสที่แข็งแรง เลือกคีย์ที่ยาวและซับซ้อน เพื่อให้การคาดเดาคีย์ทำได้ยาก
    - ใช้โปรโตคอลการเข้ารหัสที่ปลอดภัย เลือกใช้มาตรฐานการเข้ารหัสที่เชื่อถือได้ เช่น AES (Advanced Encryption Standard)
    - จัดการคีย์อย่างปลอดภัย เก็บคีย์เข้ารหัสในที่ที่ปลอดภัย เช่น ใช้ hardware security module (HSM) หรือ keystore
    - การใช้การเข้ารหัสแบบ end-to-end ให้ข้อมูลถูกเข้ารหัสตั้งแต่ต้นทางถึงปลายทาง เพื่อป้องกันการถูกดักฟังระหว่างทาง
    - อัปเดตและติดตามเทคโนโลยี ติดตามและอัปเดตเทคโนโลยีการเข้ารหัสใหม่ ๆ เพื่อป้องกันการถูกโจมตีจากช่องโหว่ที่เกิดขึ้นใหม่
      
___

  ### Signing การสร้างลายเซ็นดิจิทัลเพื่อยืนยันความถูกต้อง
    
  - **ตัวอย่าง**
    
    1.การสร้างลายเซ็นดิจิทัล
    
    - Alice ต้องการส่งข้อความสำคัญไปให้ Bob และต้องการให้ Bob มั่นใจว่าข้อความไม่ได้ถูกแก้ไข
    - Alice ใช้ คีย์ส่วนตัว (private key) ของเธอในการสร้างลายเซ็นดิจิทัลจากข้อความ
    - Alice ส่งข้อความและลายเซ็นดิจิทัลไปให้ Bob
        
    2.การตรวจสอบลายเซ็นดิจิทัล

    - เมื่อ Bob ได้รับข้อความและลายเซ็นดิจิทัล เขาใช้ คีย์สาธารณะ (public key) ของ Alice เพื่อตรวจสอบลายเซ็นดิจิทัล
    - ถ้าลายเซ็นดิจิทัลถูกต้อง Bob จะรู้ว่าข้อความไม่ได้ถูกแก้ไข และข้อความนั้นมาจาก Alice จริง ๆ

  - **วิธีการป้องกัน**
    
    - เก็บรักษาคีย์ส่วนตัวในที่ที่ปลอดภัย ไม่ให้คีย์รั่วไหลหรือถูกขโมย
    - ใช้คีย์ความยาวมากพอที่จะป้องกันการโจมตีจากการเดาหรือการประมวลผล
    - ตรวจสอบลายเซ็นดิจิทัลทุกครั้งที่ได้รับข้อมูลที่สำคัญ เพื่อยืนยันว่าข้อมูลมาจากผู้ส่งที่แท้จริงและไม่ถูกแก้ไข
    - ใช้โปรโตคอลและอัลกอริธึมการเข้ารหัสที่ทันสมัย เช่น RSA หรือ ECC เพื่อให้มั่นใจว่าระบบยังคงปลอดภัยแม้ในปัจจุบัน

___

  ### Keystores การเก็บคีย์เข้ารหัสในที่ปลอดภัย

  - **ตัวอย่าง**
    - เมื่อเราต้องการส่งเอกสารที่มีความสำคัญแก่บริษัท เราอาจใช้คีย์ส่วนตัวของเราในการเซ็นลายเซ็นดิจิทัลบนเอกสารนั้น เมื่อเอกสารถูกตรวจสอบและถูกยอมรับใน keystore ของบริษัท การตรวจสอบความถูกต้องของลายเซ็นดิจิทัลนั้นจะช่วยให้เรามั่นใจว่าเอกสารนั้นมาจากต้นฉบับและไม่มีการแก้ไข
      
  - **วิธีการป้องกัน**
    - เพื่อป้องกันการทำลายหรือขโมยข้อมูลใน keystore นั้น ควรดำเนินการตามหลักความปลอดภัยต่อเครื่องเข้ารหัส เช่น การใช้รหัสผ่านที่ปลอดภัย การสร้างคีย์ส่วนตัวและคีย์สาธารณะที่มีความเข้มงวด และการจำกัดการเข้าถึงของ keystore เฉพาะผู้ที่มีสิทธิ์ที่จำเป็นเท่านั้น

___
  ### Security defaults การใช้ค่าความปลอดภัยที่เป็นค่าเริ่มต้น

  - **ตัวอย่าง**
    
    - การปิดฟีเจอร์ที่ไม่จำเป็น เช่น ปิดการใช้งานบริการที่ไม่ได้ใช้และเป็นพื้นที่เสี่ยง
    - การใช้ค่าเริ่มต้นที่มีความปลอดภัย เช่น การสร้างรหัสผ่านที่มีความซับซ้อน
    - การป้องกันการโจมตีแบบ brute force โดยจำกัดจำนวนครั้งที่ลองเข้าสู่ระบบได้
   
  - **วิธีการป้องกัน**

    - ตรวจสอบและปรับเปลี่ยนการตั้งค่าค่าเริ่มต้นให้เป็นค่าที่มีความปลอดภัยสูง
    - ใช้การตั้งค่าที่มีความปลอดภัยเป็นค่าเริ่มต้นในระบบหรือโปรแกรม
    - ปรับเปลี่ยนการใช้ฟีเจอร์ที่ไม่จำเป็นเพื่อลดความเสี่ยงจากการโจมตี
        
___

  ### Post quantum crypto การเข้ารหัสเพื่อป้องกันการโจมตีจากคอมพิวเตอร์ควอนตัมในอนาคต
    
  - **ตัวอย่าง**
    
    - NTRUEncrypt ใช้วิธีการเข้ารหัส NTRU ที่สามารถทนต่อการถอดรหัสโดยใช้คอมพิวเตอร์ควอนตัมได้
    - Lattice-based cryptography การใช้กริด (lattice) ในการสร้างระบบเข้ารหัสที่ทนต่อการโจมตีจากคอมพิวเตอร์ควอนตัม

  - **วิธีการป้องกัน**

    - การใช้กระบวนการเข้ารหัสที่ทนต่อการถอดรหัสโดยใช้คอมพิวเตอร์ควอนตัม การเลือกใช้วิธีการเข้ารหัสที่ไม่สามารถถอดรหัสได้ด้วยคอมพิวเตอร์ควอนตัม
    - การวิเคราะห์และทดสอบความปลอดภัย การตรวจสอบและทดสอบว่าระบบเข้ารหัสที่ใช้มีความปลอดภัยจากการถอดรหัสโดยใช้คอมพิวเตอร์ควอนตัมหรือไม่
    - การพัฒนาเทคโนโลยีเข้ารหัสใหม่ การวิจัยและพัฒนาเทคโนโลยีเข้ารหัสใหม่ที่ทนต่อการโจมตีจากคอมพิวเตอร์ควอนตัม อาจมีการใช้กริด (lattice) หรือวิธีการเข้ารหัสอื่นที่ทนต่อคอมพิวเตอร์ควอนตัม
    
___

  - **Video ตัวอย่าง** [Insecure Direct Object References (IDOR)]
https://youtu.be/ybdR4mIXrvw
