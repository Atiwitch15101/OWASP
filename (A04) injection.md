# Injection

Injection คือ การโจมตีที่ผู้ไม่ประสงค์ดีสามารถฝังโค้ดที่ไม่ควรเข้ามาในแอปพลิเคชันของเรา ซึ่งอาจเป็น SQL Injection, Cross-Site Scripting (XSS), หรือชนิดอื่น ๆ โดยตรงผ่านข้อมูลที่ผู้โจมตีส่งเข้ามาผ่านช่องโหว่ที่ไม่ควรเกิดขึ้น

# SQL injection (into) 

การโจมตีชนิดหนึ่งที่ผู้โจมตีส่งข้อมูลที่ไม่ปลอดภัยเข้าสู่ระบบฐานข้อมูลผ่านช่องโหว่ SQL query ของเว็บแอปพลิเคชัน เพื่อให้เกิดการดำเนินการ SQL ที่ไม่ถูกต้องหรือไม่ปลอดภัย

  - **ตัวอย่าง**
    > - ผู้โจมตีพบช่องโหว่ SQL Injection (into) ในแอปพลิเคชันที่รับข้อมูลที่ไม่ได้กรองค่าอย่างถูกต้อง เช่น แบบฟอร์มค้นหาที่ไม่มีการกรองข้อมูล
    > - ผู้โจมตีใส่โค้ด SQL อันตรายเข้าไปในช่องโหว่ เช่น ' OR 1=1 -- ซึ่งจะทำให้คำสั่ง SQL ที่ถูกสร้างขึ้นดูเป็นแบบนี้: SELECT * FROM users WHERE username='' OR 1=1 -- AND password=''
    > - คำสั่ง SQL ที่ถูกเขียนโดยผู้โจมตีจะส่งคืนข้อมูลทั้งหมดจากตาราง users โดยไม่ต้องการการยืนยันตัวตนหรือรหัสผ่าน
    > - ผู้โจมตีสามารถเข้าถึงข้อมูลของผู้ใช้ทั้งหมดในฐานข้อมูลหรือทำการปรับเปลี่ยนข้อมูลได้ตามที่ต้องการ

  - **ป้องกันอย่างไร**
    > - ใช้ Parameterized Queries หรือ Prepared Statements ใช้เทคนิคนี้เพื่อป้องกันการฝังข้อมูลไม่ปลอดภัยเข้าไปในคำสั่ง SQL
    > - ตรวจสอบข้อมูลที่รับเข้ามา ตรวจสอบและ validate ข้อมูลที่รับเข้ามาก่อนนำไปใช้งาน
    > - กำหนดสิทธิ์และ Permission ให้เหมาะสม กำหนดสิทธิ์การเข้าถึงข้อมูลและการดำเนินการในฐานข้อมูลให้เหมาะสมตามบทบาทของผู้ใช้งาน
    
___

# SQL Injection (advanced)

เป็นรูปแบบที่ซับซ้อนขึ้นจาก SQL Injection ปกติ โดยมีการใช้เทคนิคแบบ Union Query, Blind SQL Injection, Time-Based Blind SQL Injection เพื่อโจมตีฐานข้อมูลของเว็บไซต์

  - **ตัวอย่าง**
    
    > - ค้นหาช่องโหว่ SQL Injection ในเว็บไซต์ เช่น ในช่องค้นหาหรือแบบฟอร์มอื่น ๆ ที่รับข้อมูลจากผู้ใช้งาน
    > - ใส่โค้ด SQL Injection ลงไปในช่องโหว่ เช่น ' OR 1=1 -- หรือ ' UNION SELECT username, password FROM users --
    > - ทดสอบการโจมตีโดยดูผลลัพธ์ที่แสดงออกมา เช่น การแสดงข้อมูลผู้ใช้งานหรือการเข้าถึงข้อมูลอื่น ๆ ในฐานข้อมูล

  - **ป้องกันอย่างไร**

    > - **ใช้ Parameterized Queries** ใช้การสร้างคำสั่ง SQL ด้วยพารามิเตอร์เพื่อป้องกันการฝังโค้ด SQL ไม่ปลอดภัย
    > - **ตรวจสอบข้อมูล** ตรวจสอบข้อมูลที่รับเข้ามาจากผู้ใช้งานเพื่อระบุว่ามีการแทรกโค้ด SQL หรือไม่
    > - **กำหนดสิทธิ์** กำหนดสิทธิ์การเข้าถึงฐานข้อมูลอย่างเหมาะสมเพื่อลดความเสี่ยงจาก SQL Injection
    > - **ใช้ WAF (Web Application Firewall)** ใช้ WAF เพื่อตรวจจับและป้องกัน SQL Injection และช่องโหว่ที่เกี่ยวข้องอื่น ๆ
  
___

# SQL injection (mitigation)

การป้องกันช่องโหว่ SQL Injection หรือลดความเสี่ยงจาก SQL Injection ที่อาจเกิดขึ้นในเว็บแอปพลิเคชัน โดยการใช้เทคนิคหรือเครื่องมือที่ช่วยป้องกันช่องโหว่นี้ได้

  - **ตัวอย่าง**
    
    > - การใช้ Parameterized Queries หรือ Prepared Statements เพื่อป้องกัน SQL Injection โดยการแทนที่ค่าของพารามิเตอร์ในคำสั่ง SQL ด้วยตัวแปรที่ถูกต้องและไม่สามารถถูกโจมตีได้
    > - การตรวจสอบข้อมูลที่รับเข้ามาจากผู้ใช้งานเพื่อตรวจสอบความถูกต้องและความปลอดภัยก่อนนำเข้าใช้งาน
    
  - **ป้องกันอย่างไร**
    
    > - **การใช้ Parameterized Queries หรือ Prepared Statements** นำข้อมูลที่ได้รับมาจากผู้ใช้ใส่ในพารามิเตอร์ของคำสั่ง SQL แทนที่จะตรงๆ เพื่อป้องกันการฝังข้อมูลไม่ปลอดภัยในคำสั่ง SQL     
    > - **การทำ Input Validation** ตรวจสอบและกำหนดเงื่อนไขให้ข้อมูลที่รับเข้ามามีความถูกต้องและเป็นไปตามรูปแบบที่ต้องการ  
    > - **การใช้ ORM (Object-Relational Mapping)** ใช้เทคโนโลยี ORM เพื่อจัดการข้อมูลในฐานข้อมูลโดยไม่ต้องใช้คำสั่ง SQL โดยตรง ซึ่ง ORM มักจะมีการป้องกันช่องโหว่ SQL Injection อย่างมีประสิทธิภาพ
    > - **การใช้ Stored Procedures** ใช้ Stored Procedures ในการดำเนินการกับข้อมูลในฐานข้อมูล ซึ่ง Stored Procedures มักจะถูกคอมไพล์และตรวจสอบก่อนการใช้งานเพื่อป้องกัน SQL Injection ในระดับที่ความเสี่ยงน้อยลง

___

# Cross Site Scripting

เป็นช่องโหว่ที่ผู้โจมตีสามารถฝังโค้ด JavaScript หรือโค้ดอื่น ๆ ที่มีความอันตรายในเว็บไซต์ เพื่อทำให้ผู้ใช้งานอื่น ๆ ในเว็บไซต์นั้นๆ ทำตามคำสั่งที่โจมตีได้ ซึ่งอาจทำให้เกิดผลกระทบต่อความปลอดภัยของเว็บไซต์นั้น ๆ

  - **ตัวอย่าง**
    > ผู้โจมตีส่งข้อความหรือข้อมูลที่มีโค้ด JavaScript ที่ถูกฝังไว้เข้าไปในฟอร์มการค้นหาหรือข้อมูลในเว็บไซต์ และเมื่อผู้ใช้คลิกเข้าไปที่ลิงก์นั้น โค้ด JavaScript นั้นจะทำงานและทำให้เกิดผลกระทบตามที่ผู้โจมตีต้องการ เช่น การแสดงข้อความปลอมหรือการดักและขโมยข้อมูลผู้ใช้
    
  - **ป้องกันอย่างไร**
    > สำหรับ XSS จะใช้การ Validate ข้อมูลที่รับเข้ามาให้เป็นตัวเลขหรือตัวอักษรเท่านั้น และ Escape หรือ Encode ข้อมูลที่แสดงผลบนเว็บ เช่น htmlspecialchars() หรือ htmlentities() เพื่อป้องกันการฝังโค้ด JavaScript ในเว็บ

___

# Cross Site Scripting (stored)

คือช่องโหว่ XSS ที่โค้ด JavaScript ที่อันตรายถูกบันทึกลงในฐานข้อมูล และเมื่อมีผู้ใช้คนอื่น ๆ เข้ามาดูหรือใช้งานข้อมูลนั้น ๆ ที่มีโค้ดนั้นๆ ในเว็บไซต์ โค้ดนั้นจะถูกทำงาน

  - **ตัวอย่าง**
    > ในกรณีของเว็บบอร์ด ผู้โจมตีอาจฝังโค้ด JavaScript ที่อันตรายในโพสต์ที่เป็นข้อมูลต่างๆ และเมื่อผู้ใช้งานอื่น ๆ เข้ามาอ่านโพสต์นั้น โค้ด JavaScript นั้นจะทำงานและทำให้เกิดผลกระทบตามที่ผู้โจมตีต้องการ

  - **ป้องกันอย่างไร**
    > สำหรับ XSS (stored) จะต้องทำการตรวจสอบและกำหนดสิทธิ์การเข้าถึงข้อมูลอย่างเหมาะสม และใช้การ Escape หรือ Encode ข้อมูลที่แสดงผลบนเว็บ เช่น htmlspecialchars() หรือ htmlentities()

___

# Cross Site Scripting (mitigation)

เป็นการลดความเสี่ยงจาก XSS โดยการใช้ Filter ในการตรวจสอบและลบข้อมูลที่มีโค้ด JavaScript หรืออื่น ๆ ที่อันตรายออกไป ก่อนที่จะแสดงผลบนเว็บไซต์

  - **ตัวอย่าง**
    > การใช้ Filter ในการตรวจสอบและลบข้อความที่มีโค้ด JavaScript หรือ HTML ที่อันตรายออกไปก่อนที่จะแสดงผลบนเว็บ

  - **ป้องกันอย่างไร**
    > นอกจากการใช้ Filter แล้วยังควรใช้การ Escape หรือ Encode ข้อมูลที่แสดงผลบนเว็บ เช่น htmlspecialchars() หรือ htmlentities() เพื่อป้องกันการฝังโค้ด JavaScript ในเว็บ

___

# Path Traversal 

Path Traversal เป็นช่องโหว่ที่อนุญาตให้ผู้โจมตีเข้าถึงไฟล์หรือโฟลเดอร์ที่ไม่ได้รับอนุญาต โดยการใช้สัญลักษณ์เดี่ยวกับการเข้าถึงไฟล์บนเซิร์ฟเวอร์ ซึ่งสามารถทำให้ผู้โจมตีสามารถอ่านหรือเขียนไฟล์ที่ระบบไม่ควรให้เข้าถึงได้

  - **ตัวอย่าง**
    > สมมติว่าเว็บไซต์ต้องการแสดงไฟล์รูปภาพที่เก็บอยู่ในโฟลเดอร์ที่ตั้งไว้ เช่น `/images/` และมีการรับ input จากผู้ใช้เพื่อเลือกไฟล์ เช่น `image.jpg` โดยเมื่อผู้ใช้ระบุ `../../secret/passwords.txt` สิ่งนี้อาจทำให้เกิด Path Traversal โดยเข้าถึงไฟล์ passwords.txt ที่ไม่ควรเปิดเผย

  - **ป้องกันอย่างไร**
    > วิธีที่ดีที่สุดในการป้องกัน Path Traversal คือการตรวจสอบและกำหนดสิทธิ์การเข้าถึงไฟล์และโฟลเดอร์อย่างเหมาะสม เช่น ให้ใช้ Whitelisting เพื่อจำกัดเฉพาะไฟล์และโฟลเดอร์ที่เป็นไปได้ที่ผู้ใช้สามารถเข้าถึงได้ เปิดอ่านไฟล์ตั้งแต่ภาพแรกของเว็บไซต์หรือจำกัดการเข้าถึงของไฟล์ด้วยคำสั่ง `.htaccess` หรือหลีกเลี่ยงการใช้ชื่อไฟล์และที่อยู่เต็มในการรับ input จากผู้ใช้
